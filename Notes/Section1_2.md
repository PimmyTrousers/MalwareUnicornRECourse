## Section 1.2 Fundamentals:

### Anatomy of a Windows PE C Program

Typical windos programs are in the Portable Executable format (PE). Its portable becaue it contains information, resources, and references to dynamic-linked libraries that allow windows to load and execute the machine code.

Code Stack:
- C/C++ Code
- Compiler
- x86 assembly
- Machine code/Binary/Hex
- Hardware

### Windows architecture

**User-mode vs. Kernel Mode**
  - In user-mode an application starts a user-mode process which comes with its own private virtual address space and handle table
  - In kernel mode, applications share virtual address space

### PE Header

The PE header provides information to operating systems on how to map the file to memory. The executable code has designated regions that require a different memory protection
  - read
  - write
  - executable

### Memory Layout

  - **Stack** - region of memory is added or removed using LIFO procedure
  - **Heap** - region for dynamic memory allocation
  - **Program Image** - The PE executable code placed into memory
  - **DLLs** - Loaded DLL images that are referenced by the PE
  - **TEB** - Threat Environment Block stores information about the current running threads
  - **PEB** Process Environment Block stores information about loadaed modules and processes

The order of how PEs are placed into memory is as follows form bottom to top:
  - Kernal Land
  - PEB
  - TEB
  - DLLs
  - Program Image
  - Heap (Grows down to higher addresses)
  - Stack (Grows up to lower addresses)

### The Stack
  - Data is either pushed onto or popped off of the stack data structure
  - **EBP** - Base Pointer is the register that used to store the references in the stack frame (See image Stack Frame)
